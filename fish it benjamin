local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- 1. Dasar ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CharlesHub_V6"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Warna Tema
local MainBlue = Color3.fromRGB(0, 170, 255)
local SuccessGreen = Color3.fromRGB(0, 255, 127) 
local BgColor = Color3.fromRGB(15, 15, 15)

-- FUNGSI DRAG
local function makeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- 2. LOADING SCREEN DENGAN EFEK METEOR
local LoadingScreen = Instance.new("Frame")
LoadingScreen.Size = UDim2.new(1, 0, 1, 0)
LoadingScreen.BackgroundTransparency = 1
LoadingScreen.ZIndex = 100
LoadingScreen.Parent = ScreenGui

-- Fungsi membuat partikel meteor jatuh
local function createMeteor()
    local meteor = Instance.new("TextLabel")
    meteor.Text = "☄️"
    meteor.BackgroundTransparency = 1
    meteor.TextSize = math.random(15, 30)
    meteor.Position = UDim2.new(math.random(), 0, -0.1, 0)
    meteor.Parent = LoadingScreen
    
    local duration = math.random(1, 3)
    TweenService:Create(meteor, TweenInfo.new(duration, Enum.EasingStyle.Linear), {
        Position = UDim2.new(meteor.Position.X.Scale - 0.2, 0, 1.1, 0),
        Rotation = 360
    }):Play()
    
    task.delay(duration, function() meteor:Destroy() end)
end

-- Jalankan efek meteor selama loading
local spawningMeteors = true
task.spawn(function()
    while spawningMeteors do
        createMeteor()
        task.wait(0.2)
    end
end)

local LoadingContainer = Instance.new("Frame")
LoadingContainer.Size = UDim2.new(0, 300, 0, 100)
LoadingContainer.Position = UDim2.new(0.5, -150, 0.5, -50)
LoadingContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
LoadingContainer.BorderSizePixel = 0
LoadingContainer.Parent = LoadingScreen
Instance.new("UICorner", LoadingContainer)
Instance.new("UIStroke", LoadingContainer).Color = SuccessGreen

local LoadingText = Instance.new("TextLabel")
LoadingText.Size = UDim2.new(1, 0, 0, 50)
LoadingText.BackgroundTransparency = 1
LoadingText.Text = "Charles Hub Memuat"
LoadingText.TextColor3 = Color3.new(1, 1, 1)
LoadingText.Font = Enum.Font.GothamBold
LoadingText.TextSize = 20
LoadingText.Parent = LoadingContainer

local BarBg = Instance.new("Frame")
BarBg.Size = UDim2.new(0.8, 0, 0, 6)
BarBg.Position = UDim2.new(0.1, 0, 0, 70)
BarBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
BarBg.Parent = LoadingContainer
Instance.new("UICorner", BarBg)

local BarFill = Instance.new("Frame")
BarFill.Size = UDim2.new(0, 0, 1, 0)
BarFill.BackgroundColor3 = SuccessGreen
BarFill.Parent = BarBg
Instance.new("UICorner", BarFill)

-- 3. MAIN FRAME & ICON (SAMA SEPERTI SEBELUMNYA)
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 380, 0, 250)
MainFrame.Position = UDim2.new(0.5, -190, 0.5, -125)
MainFrame.BackgroundColor3 = BgColor
MainFrame.Visible = false
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame)
Instance.new("UIStroke", MainFrame).Color = MainBlue

local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 35)
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TopBar.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Text = "☄️      Charles Hub"
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1
Title.Parent = TopBar

local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0, 22, 0, 22)
CloseBtn.Position = UDim2.new(1, -28, 0, 6)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.Parent = TopBar
Instance.new("UICorner", CloseBtn)

local MinBtn = Instance.new("TextButton")
MinBtn.Text = "-"
MinBtn.Size = UDim2.new(0, 22, 0, 22)
MinBtn.Position = UDim2.new(1, -55, 0, 6)
MinBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MinBtn.TextColor3 = Color3.new(1,1,1)
MinBtn.Parent = TopBar
Instance.new("UICorner", MinBtn)

local MinIcon = Instance.new("TextButton")
MinIcon.Size = UDim2.new(0, 110, 0, 32)
MinIcon.Position = UDim2.new(0.05, 0, 0.9, 0)
MinIcon.BackgroundColor3 = BgColor
MinIcon.Text = "☄️   Charles X"
MinIcon.TextColor3 = Color3.new(1,1,1)
MinIcon.Font = Enum.Font.GothamBold
MinIcon.TextSize = 12
MinIcon.Visible = false
MinIcon.Parent = ScreenGui
Instance.new("UICorner", MinIcon)
Instance.new("UIStroke", MinIcon).Color = MainBlue

makeDraggable(MainFrame, TopBar)
makeDraggable(MinIcon, MinIcon)

-- JALANKAN LOADING
task.spawn(function()
    TweenService:Create(BarFill, TweenInfo.new(3, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 1, 0)}):Play()
    task.wait(3.2)
    spawningMeteors = false -- Berhenti bikin meteor
    LoadingScreen:Destroy()
    
    MainFrame.Visible = true
    MainFrame.Size = UDim2.new(0,0,0,0)
    TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(0, 380, 0, 250)}):Play()
end)

-- LOGIKA TUTUP & MINIMIZE
CloseBtn.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.3)
    ScreenGui:Destroy()
end)

MinBtn.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.4)
    MainFrame.Visible = false
    MinIcon.Visible = true
    MinIcon.Size = UDim2.new(0,0,0,32)
    TweenService:Create(MinIcon, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 110, 0, 32)}):Play()
end)

MinIcon.MouseButton1Click:Connect(function()
    TweenService:Create(MinIcon, TweenInfo.new(0.2), {Size = UDim2.new(0,0,0,32)}):Play()
    task.wait(0.2)
    MinIcon.Visible = false
    MainFrame.Visible = true
    TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(0, 380, 0, 250)}):Play()
end)
