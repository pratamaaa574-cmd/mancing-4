local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- 1. Dasar ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CharlesHub_V4"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Warna Tema
local MainBlue = Color3.fromRGB(0, 170, 255)
local SuccessGreen = Color3.fromRGB(0, 255, 127) -- Warna Hijau untuk Bar
local BgColor = Color3.fromRGB(15, 15, 15)

-- FUNGSI DRAG (Agar menu & icon bisa digeser)
local function makeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- 2. ANIMASI LOADING (TIDAK POLOS)
local LoadingFrame = Instance.new("Frame")
LoadingFrame.Size = UDim2.new(1, 0, 1, 0)
LoadingFrame.BackgroundTransparency = 0.4 -- Tidak hitam polos (agak transparan)
LoadingFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
LoadingFrame.ZIndex = 100
LoadingFrame.Parent = ScreenGui

local LoadingContent = Instance.new("Frame")
LoadingContent.Size = UDim2.new(0, 350, 0, 120)
LoadingContent.Position = UDim2.new(0.5, -175, 0.5, -60)
LoadingContent.BackgroundColor3 = BgColor
LoadingContent.Parent = LoadingFrame
Instance.new("UICorner", LoadingContent)
Instance.new("UIStroke", LoadingContent).Color = SuccessGreen

local LoadingText = Instance.new("TextLabel")
LoadingText.Size = UDim2.new(1, 0, 0, 50)
LoadingText.Position = UDim2.new(0, 0, 0, 10)
LoadingText.BackgroundTransparency = 1
LoadingText.Text = "☄️   Charles Hub Memuat"
LoadingText.TextColor3 = Color3.new(1, 1, 1)
LoadingText.Font = Enum.Font.GothamBold
LoadingText.TextSize = 20
LoadingText.Parent = LoadingContent

-- Bar di bawah teks
local BarBg = Instance.new("Frame")
BarBg.Size = UDim2.new(0.8, 0, 0, 8)
BarBg.Position = UDim2.new(0.1, 0, 0, 70)
BarBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
BarBg.BorderSizePixel = 0
BarBg.Parent = LoadingContent
Instance.new("UICorner", BarBg)

local BarFill = Instance.new("Frame")
BarFill.Size = UDim2.new(0, 0, 1, 0)
BarFill.BackgroundColor3 = SuccessGreen -- Bar warna Hijau
BarFill.BorderSizePixel = 0
BarFill.Parent = BarBg
Instance.new("UICorner", BarFill)

-- 3. MAIN FRAME (UKURAN KECIL)
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 380, 0, 250)
MainFrame.Position = UDim2.new(0.5, -190, 0.5, -125)
MainFrame.BackgroundColor3 = BgColor
MainFrame.Visible = false
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame)
local Stroke = Instance.new("UIStroke", MainFrame)
Stroke.Color = MainBlue
Stroke.Thickness = 1.5

local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 35)
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TopBar.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Text = "☄️      Charles Hub"
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1
Title.Parent = TopBar

local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.Position = UDim2.new(1, -30, 0, 5)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.Parent = TopBar
Instance.new("UICorner", CloseBtn)

local MinBtn = Instance.new("TextButton")
MinBtn.Text = "-"
MinBtn.Size = UDim2.new(0, 24, 0, 24)
MinBtn.Position = UDim2.new(1, -60, 0, 5)
MinBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MinBtn.TextColor3 = Color3.new(1,1,1)
MinBtn.Parent = TopBar
Instance.new("UICorner", MinBtn)

-- 4. ICON MINIMIZE (BISA DIGESER)
local MinIcon = Instance.new("TextButton")
MinIcon.Size = UDim2.new(0, 110, 0, 35)
MinIcon.Position = UDim2.new(0, 20, 1, -55)
MinIcon.BackgroundColor3 = BgColor
MinIcon.Text = "☄️   Charles X"
MinIcon.TextColor3 = Color3.new(1,1,1)
MinIcon.Font = Enum.Font.GothamBold
MinIcon.TextSize = 13
MinIcon.Visible = false
MinIcon.Parent = ScreenGui
Instance.new("UICorner", MinIcon)
local MinStroke = Instance.new("UIStroke", MinIcon)
MinStroke.Color = MainBlue

makeDraggable(MainFrame, TopBar)
makeDraggable(MinIcon, MinIcon)

-- PROSES LOADING (Nunggu Bar Penuh)
task.spawn(function()
    local loadingTime = 2.5 -- Durasi bar mengisi
    local tween = TweenService:Create(BarFill, TweenInfo.new(loadingTime, Enum.EasingStyle.Linear), {Size = UDim2.new(1, 0, 1, 0)})
    tween:Play()
    
    tween.Completed:Wait() -- Menunggu bar benar-benar penuh
    task.wait(0.2)
    
    -- Animasi Loading Menghilang
    TweenService:Create(LoadingFrame, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(LoadingContent, TweenInfo.new(0.5), {Position = UDim2.new(0.5, -175, 0.5, 50), BackgroundTransparency = 1}):Play()
    task.wait(0.5)
    LoadingFrame:Destroy()
    
    -- Membuka Main Menu dengan Animasi Pop-up
    MainFrame.Visible = true
    MainFrame.Size = UDim2.new(0,0,0,0)
    TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(0, 380, 0, 250)}):Play()
end)

--- ANIMASI TUTUP (CLOSE) ---
CloseBtn.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.3)
    ScreenGui:Destroy()
end)

--- ANIMASI MINIMIZE ---
MinBtn.MouseButton1Click:Connect(function()
    TweenService:Connect(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.4)
    MainFrame.Visible = false
    MinIcon.Visible = true
    MinIcon.Size = UDim2.new(0,0,0,35)
    TweenService:Create(MinIcon, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 110, 0, 35)}):Play()
end)

MinIcon.MouseButton1Click:Connect(function()
    TweenService:Create(MinIcon, TweenInfo.new(0.2), {Size = UDim2.new(0,0,0,35)}):Play()
    task.wait(0.2)
    MinIcon.Visible = false
    MainFrame.Visible = true
    TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(0, 380, 0, 250)}):Play()
end)
