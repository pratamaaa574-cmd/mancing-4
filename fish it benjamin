local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- 1. Dasar ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CharlesHub_V8"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Warna Tema
local MainBlue = Color3.fromRGB(0, 170, 255)
local SuccessGreen = Color3.fromRGB(0, 255, 127) 
local BgColor = Color3.fromRGB(15, 15, 15)
local SidebarColor = Color3.fromRGB(20, 20, 20)
local AccentColor = Color3.fromRGB(30, 30, 30)

-- FUNGSI DRAG
local function makeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- 2. LOADING SCREEN & EFEK METEOR
local LoadingScreen = Instance.new("Frame")
LoadingScreen.Size = UDim2.new(1, 0, 1, 0)
LoadingScreen.BackgroundTransparency = 1
LoadingScreen.ZIndex = 100
LoadingScreen.Parent = ScreenGui

local function createMeteor()
    local meteor = Instance.new("TextLabel")
    meteor.Text = "‚òÑÔ∏è"
    meteor.BackgroundTransparency = 1
    meteor.TextSize = math.random(15, 30)
    meteor.Position = UDim2.new(math.random(), 0, -0.1, 0)
    meteor.Parent = LoadingScreen
    local duration = math.random(1, 3)
    TweenService:Create(meteor, TweenInfo.new(duration, Enum.EasingStyle.Linear), {Position = UDim2.new(meteor.Position.X.Scale - 0.2, 0, 1.1, 0), Rotation = 360}):Play()
    task.delay(duration, function() meteor:Destroy() end)
end

local spawningMeteors = true
task.spawn(function() while spawningMeteors do createMeteor() task.wait(0.2) end end)

local LoadingContainer = Instance.new("Frame")
LoadingContainer.Size = UDim2.new(0, 300, 0, 100)
LoadingContainer.Position = UDim2.new(0.5, -150, 0.5, -50)
LoadingContainer.BackgroundColor3 = SidebarColor
LoadingContainer.Parent = LoadingScreen
Instance.new("UICorner", LoadingContainer)
Instance.new("UIStroke", LoadingContainer).Color = SuccessGreen

local LoadingText = Instance.new("TextLabel")
LoadingText.Size = UDim2.new(1, 0, 0, 50)
LoadingText.BackgroundTransparency = 1
LoadingText.Text = "Charles Hub Memuat"
LoadingText.TextColor3 = Color3.new(1, 1, 1)
LoadingText.Font = Enum.Font.GothamBold
LoadingText.TextSize = 20
LoadingText.Parent = LoadingContainer

local BarBg = Instance.new("Frame")
BarBg.Size = UDim2.new(0.8, 0, 0, 6)
BarBg.Position = UDim2.new(0.1, 0, 0, 70)
BarBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
BarBg.Parent = LoadingContainer
Instance.new("UICorner", BarBg)

local BarFill = Instance.new("Frame")
BarFill.Size = UDim2.new(0, 0, 1, 0)
BarFill.BackgroundColor3 = SuccessGreen
BarFill.Parent = BarBg
Instance.new("UICorner", BarFill)

-- 3. MAIN FRAME (DENGAN SIDEBAR)
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 450, 0, 300)
MainFrame.Position = UDim2.new(0.5, -225, 0.5, -150)
MainFrame.BackgroundColor3 = BgColor
MainFrame.Visible = false
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame)
Instance.new("UIStroke", MainFrame).Color = MainBlue

-- Sidebar
local Sidebar = Instance.new("Frame")
Sidebar.Size = UDim2.new(0, 130, 1, 0)
Sidebar.BackgroundColor3 = SidebarColor
Sidebar.BorderSizePixel = 0
Sidebar.Parent = MainFrame
Instance.new("UICorner", Sidebar)

local SidebarList = Instance.new("UIListLayout")
SidebarList.Parent = Sidebar
SidebarList.Padding = UDim.new(0, 5)
SidebarList.HorizontalAlignment = Enum.HorizontalAlignment.Center

local SidebarPadding = Instance.new("UIPadding")
SidebarPadding.PaddingTop = UDim.new(0, 45)
SidebarPadding.Parent = Sidebar

-- Page Container
local PageContainer = Instance.new("Frame")
PageContainer.Size = UDim2.new(1, -140, 1, -50)
PageContainer.Position = UDim2.new(0, 135, 0, 45)
PageContainer.BackgroundTransparency = 1
PageContainer.Parent = MainFrame

local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TopBar.ZIndex = 2
TopBar.Parent = MainFrame
Instance.new("UICorner", TopBar)

local Title = Instance.new("TextLabel")
Title.Text = "‚òÑÔ∏è Charles Hub"
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1
Title.Parent = TopBar

-- Tombol Close & Minimize
local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.Position = UDim2.new(1, -32, 0, 8)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.Parent = TopBar
Instance.new("UICorner", CloseBtn)

local MinBtn = Instance.new("TextButton")
MinBtn.Text = "-"
MinBtn.Size = UDim2.new(0, 24, 0, 24)
MinBtn.Position = UDim2.new(1, -62, 0, 8)
MinBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MinBtn.TextColor3 = Color3.new(1,1,1)
MinBtn.Parent = TopBar
Instance.new("UICorner", MinBtn)

-- FUNGSI TAB & FITUR
local Tabs = {}
function CreateTab(name, icon)
    local TabBtn = Instance.new("TextButton")
    TabBtn.Size = UDim2.new(0.9, 0, 0, 35)
    TabBtn.BackgroundColor3 = AccentColor
    TabBtn.Text = icon .. " " .. name
    TabBtn.TextColor3 = Color3.new(1,1,1)
    TabBtn.Font = Enum.Font.GothamBold
    TabBtn.TextSize = 12
    TabBtn.Parent = Sidebar
    Instance.new("UICorner", TabBtn)
    
    local Page = Instance.new("ScrollingFrame")
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundTransparency = 1
    Page.Visible = false
    Page.ScrollBarThickness = 2
    Page.Parent = PageContainer
    
    local PageLayout = Instance.new("UIListLayout", Page)
    PageLayout.Padding = UDim.new(0, 10)
    PageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    TabBtn.MouseButton1Click:Connect(function()
        for _, v in pairs(PageContainer:GetChildren()) do v.Visible = false end
        for _, v in pairs(Sidebar:GetChildren()) do 
            if v:IsA("TextButton") then TweenService:Create(v, TweenInfo.new(0.3), {BackgroundColor3 = AccentColor}):Play() end 
        end
        Page.Visible = true
        TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundColor3 = MainBlue}):Play()
    end)
    
    return Page
end

-- Menambahkan Tab Fishing
local FishingPage = CreateTab("Fishing", "üêü")

-- Fungsi Membuat Toggle (On/Off)
function AddToggle(parent, text, callback)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Size = UDim2.new(0.9, 0, 0, 40)
    ToggleFrame.BackgroundColor3 = AccentColor
    ToggleFrame.Parent = parent
    Instance.new("UICorner", ToggleFrame)

    local Label = Instance.new("TextLabel")
    Label.Text = text
    Label.Size = UDim2.new(1, -60, 1, 0)
    Label.Position = UDim2.new(0, 15, 0, 0)
    Label.BackgroundTransparency = 1
    Label.TextColor3 = Color3.new(1,1,1)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Font = Enum.Font.Gotham
    Label.Parent = ToggleFrame

    local Button = Instance.new("TextButton")
    Button.Size = UDim2.new(0, 40, 0, 20)
    Button.Position = UDim2.new(1, -50, 0.5, -10)
    Button.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    Button.Text = ""
    Button.Parent = ToggleFrame
    Instance.new("UICorner", Button, {CornerRadius = UDim.new(1, 0)})

    local active = false
    Button.MouseButton1Click:Connect(function()
        active = not active
        local targetColor = active and SuccessGreen or Color3.fromRGB(100, 100, 100)
        TweenService:Create(Button, TweenInfo.new(0.3), {BackgroundColor3 = targetColor}):Play()
        callback(active)
    end)
end

-- ISI TAB FISHING
AddToggle(FishingPage, "Auto Fishing", function(state)
    print("Auto Fishing status: ", state)
    -- Taruh coding fishing kamu di sini nanti
end)

AddToggle(FishingPage, "Fast Catch", function(state)
    print("Fast Catch status: ", state)
end)

-- 4. ICON MINIMIZE (BISA DIGESER)
local MinIcon = Instance.new("TextButton")
MinIcon.Size = UDim2.new(0, 110, 0, 35)
MinIcon.Position = UDim2.new(0, 20, 1, -55)
MinIcon.BackgroundColor3 = BgColor
MinIcon.Text = "‚òÑÔ∏è   Charles X"
MinIcon.TextColor3 = Color3.new(1,1,1)
MinIcon.Font = Enum.Font.GothamBold
MinIcon.TextSize = 13
MinIcon.Visible = false
MinIcon.Parent = ScreenGui
Instance.new("UICorner", MinIcon)
local MinStroke = Instance.new("UIStroke", MinIcon)
MinStroke.Color = MainBlue

makeDraggable(MainFrame, TopBar)
makeDraggable(MinIcon, MinIcon)

-- JALANKAN LOADING
task.spawn(function()
    TweenService:Create(BarFill, TweenInfo.new(3, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 1, 0)}):Play()
    task.wait(3.2)
    spawningMeteors = false
    LoadingScreen:Destroy()
    MainFrame.Visible = true
    MainFrame.Size = UDim2.new(0,0,0,0)
    TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(0, 450, 0, 300)}):Play()
end)

-- ANIMASI BUTTONS
CloseBtn.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.3)
    ScreenGui:Destroy()
end)

MinBtn.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.4)
    MainFrame.Visible = false
    MinIcon.Visible = true
    MinIcon.Size = UDim2.new(0,0,0,35)
    TweenService:Create(MinIcon, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 110, 0, 35)}):Play()
end)

MinIcon.MouseButton1Click:Connect(function()
    MinIcon.Visible = false
    MainFrame.Visible = true
    TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(0, 450, 0, 300)}):Play()
end)
