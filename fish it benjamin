local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- 1. Dasar ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CharlesHub_V13"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Warna Tema
local MainBlue = Color3.fromRGB(0, 170, 255)
local SuccessGreen = Color3.fromRGB(0, 255, 127)
local BgColor = Color3.fromRGB(15, 15, 15)
local SidebarColor = Color3.fromRGB(20, 20, 20)
local AccentColor = Color3.fromRGB(30, 30, 30)

-- DRAG
local function makeDraggable(frame, handle)
	local dragging, dragInput, dragStart, startPos
	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	handle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- LOADING
local LoadingScreen = Instance.new("Frame", ScreenGui)
LoadingScreen.Size = UDim2.new(1,0,1,0)
LoadingScreen.BackgroundTransparency = 1
LoadingScreen.ZIndex = 200

local function meteor()
	local t = Instance.new("TextLabel", LoadingScreen)
	t.Text = "‚òÑÔ∏è"
	t.TextSize = math.random(16,28)
	t.BackgroundTransparency = 1
	t.Position = UDim2.new(math.random(),0,-0.1,0)
	TweenService:Create(t,TweenInfo.new(2),{Position=UDim2.new(t.Position.X.Scale-0.2,0,1.1,0),Rotation=360}):Play()
	task.delay(2,function() t:Destroy() end)
end

local runMeteor = true
task.spawn(function()
	while runMeteor do
		meteor()
		task.wait(0.2)
	end
end)

local LoadBox = Instance.new("Frame", LoadingScreen)
LoadBox.Size = UDim2.new(0,280,0,90)
LoadBox.Position = UDim2.new(0.5,-140,0.5,-45)
LoadBox.BackgroundColor3 = SidebarColor
Instance.new("UICorner",LoadBox)
Instance.new("UIStroke",LoadBox).Color = SuccessGreen

local LoadText = Instance.new("TextLabel", LoadBox)
LoadText.Size = UDim2.new(1,0,0,40)
LoadText.Text = "Charles Hub Memuat"
LoadText.BackgroundTransparency = 1
LoadText.Font = Enum.Font.GothamBold
LoadText.TextSize = 18
LoadText.TextColor3 = Color3.new(1,1,1)

local BarBg = Instance.new("Frame", LoadBox)
BarBg.Size = UDim2.new(0.8,0,0,5)
BarBg.Position = UDim2.new(0.1,0,0,65)
BarBg.BackgroundColor3 = Color3.fromRGB(40,40,40)
Instance.new("UICorner",BarBg)

local BarFill = Instance.new("Frame", BarBg)
BarFill.Size = UDim2.new(0,0,1,0)
BarFill.BackgroundColor3 = SuccessGreen
Instance.new("UICorner",BarFill)

-- MAIN
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0,400,0,260)
MainFrame.Position = UDim2.new(0.5,-200,0.5,-130)
MainFrame.BackgroundColor3 = BgColor
MainFrame.Visible = false
MainFrame.ClipsDescendants = true
Instance.new("UICorner",MainFrame)
Instance.new("UIStroke",MainFrame).Color = MainBlue

-- TOPBAR
local TopBar = Instance.new("Frame", MainFrame)
TopBar.Size = UDim2.new(1,0,0,35)
TopBar.BackgroundColor3 = Color3.fromRGB(25,25,25)

local Title = Instance.new("TextLabel", TopBar)
Title.Text = "‚òÑÔ∏è   Charles Hub"
Title.Size = UDim2.new(1,-80,1,0)
Title.Position = UDim2.new(0,12,0,0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = 0
Title.TextSize = 13

local CloseBtn = Instance.new("TextButton", TopBar)
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0,22,0,22)
CloseBtn.Position = UDim2.new(1,-28,0,6)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
CloseBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner",CloseBtn)

local MinBtn = Instance.new("TextButton", TopBar)
MinBtn.Text = "-"
MinBtn.Size = UDim2.new(0,22,0,22)
MinBtn.Position = UDim2.new(1,-55,0,6)
MinBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
MinBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner",MinBtn)

-- SIDEBAR
local Sidebar = Instance.new("Frame", MainFrame)
Sidebar.Size = UDim2.new(0,110,1,-35)
Sidebar.Position = UDim2.new(0,0,0,35)
Sidebar.BackgroundColor3 = SidebarColor
local SideList = Instance.new("UIListLayout", Sidebar)
SideList.Padding = UDim.new(0,6)
SideList.HorizontalAlignment = Enum.HorizontalAlignment.Center
Instance.new("UIPadding",Sidebar).PaddingTop = UDim.new(0,8)

-- PAGE
local PageContainer = Instance.new("Frame", MainFrame)
PageContainer.Size = UDim2.new(1,-120,1,-45)
PageContainer.Position = UDim2.new(0,115,0,40)
PageContainer.BackgroundTransparency = 1

local function CreateTab(name,icon)
	local Btn = Instance.new("TextButton", Sidebar)
	Btn.Size = UDim2.new(0.9,0,0,30)
	Btn.BackgroundColor3 = AccentColor
	Btn.Text = icon.." "..name
	Btn.Font = Enum.Font.GothamBold
	Btn.TextSize = 11
	Btn.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner",Btn)

	local Page = Instance.new("ScrollingFrame", PageContainer)
	Page.Size = UDim2.new(1,0,1,0)
	Page.Visible = false
	Page.ScrollBarThickness = 2
	Page.BackgroundTransparency = 1
	local L = Instance.new("UIListLayout",Page)
	L.Padding = UDim.new(0,12)

	Btn.MouseButton1Click:Connect(function()
		for _,v in pairs(PageContainer:GetChildren()) do if v:IsA("ScrollingFrame") then v.Visible=false end end
		for _,v in pairs(Sidebar:GetChildren()) do if v:IsA("TextButton") then v.BackgroundColor3=AccentColor end end
		Page.Visible=true
		Btn.BackgroundColor3=MainBlue
	end)
	return Page
end

local FishingPage = CreateTab("Fishing","üêü")
FishingPage.Visible = true

-- TOGGLE
local function Toggle(parent,text,callback)
	local Box = Instance.new("Frame",parent)
	Box.Size = UDim2.new(0.95,0,0,50)
	Box.BackgroundColor3 = AccentColor
	Instance.new("UICorner",Box)

	local L = Instance.new("TextLabel",Box)
	L.Text=text
	L.Size=UDim2.new(1,-60,1,0)
	L.Position=UDim2.new(0,10,0,0)
	L.BackgroundTransparency=1
	L.TextColor3=Color3.new(1,1,1)
	L.Font=Enum.Font.GothamBold
	L.TextXAlignment=0
	L.TextSize=12

	local B = Instance.new("TextButton",Box)
	B.Size=UDim2.new(0,40,0,20)
	B.Position=UDim2.new(1,-50,0.5,-10)
	B.BackgroundColor3=Color3.fromRGB(50,50,50)
	B.Text=""
	Instance.new("UICorner",B).CornerRadius=UDim.new(1,0)

	local C = Instance.new("Frame",B)
	C.Size=UDim2.new(0,16,0,16)
	C.Position=UDim2.new(0,2,0.5,-8)
	C.BackgroundColor3=Color3.new(1,1,1)
	Instance.new("UICorner",C).CornerRadius=UDim.new(1,0)

	local on=false
	B.MouseButton1Click:Connect(function()
		on=not on
		TweenService:Create(C,TweenInfo.new(0.25),{Position=on and UDim2.new(1,-18,0.5,-8) or UDim2.new(0,2,0.5,-8)}):Play()
		TweenService:Create(B,TweenInfo.new(0.25),{BackgroundColor3=on and SuccessGreen or Color3.fromRGB(50,50,50)}):Play()
		callback(on)
	end)
end

-- LEGIT AUTO FISH
local Fishing=false
Toggle(FishingPage,"Legit Auto Fishing (Heavy)",function(v)
	Fishing=v
	task.spawn(function()
		while Fishing do
			task.wait(math.random(12,25)/10)
			VirtualUser:Button1Down(Vector2.new(),workspace.CurrentCamera.CFrame)
			task.wait(math.random(2,4)/10)
			VirtualUser:Button1Up(Vector2.new(),workspace.CurrentCamera.CFrame)
		end
	end)
end)

-- ANTI AFK
Toggle(FishingPage,"Anti AFK",function(v)
	if v then
		task.spawn(function()
			while v do
				task.wait(30)
				VirtualUser:Button2Down(Vector2.new(),workspace.CurrentCamera.CFrame)
				task.wait(0.2)
				VirtualUser:Button2Up(Vector2.new(),workspace.CurrentCamera.CFrame)
			end
		end)
	end
end)

-- MINIMIZE ICON
local MinIcon = Instance.new("TextButton", ScreenGui)
MinIcon.Size = UDim2.new(0,100,0,32)
MinIcon.Position = UDim2.new(0,20,1,-50)
MinIcon.Text = "‚òÑÔ∏è Charles X"
MinIcon.Visible = false
MinIcon.BackgroundColor3 = BgColor
MinIcon.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner",MinIcon)
Instance.new("UIStroke",MinIcon).Color = MainBlue

makeDraggable(MainFrame,TopBar)
makeDraggable(MinIcon,MinIcon)

task.spawn(function()
	local t=TweenService:Create(BarFill,TweenInfo.new(3),{Size=UDim2.new(1,0,1,0)})
	t:Play()
	t.Completed:Wait()
	runMeteor=false
	LoadingScreen:Destroy()
	MainFrame.Visible=true
	MainFrame.Size=UDim2.new(0,0,0,0)
	TweenService:Create(MainFrame,TweenInfo.new(0.5,Enum.EasingStyle.Back),{Size=UDim2.new(0,400,0,260)}):Play()
end)

CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
MinBtn.MouseButton1Click:Connect(function() MainFrame.Visible=false MinIcon.Visible=true end)
MinIcon.MouseButton1Click:Connect(function() MinIcon.Visible=false MainFrame.Visible=true end)
