local TweenService = game:GetService("TweenService")
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- 1. Dasar ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CharlesHub_V3"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Warna Tema
local MainBlue = Color3.fromRGB(0, 170, 255)
local BgColor = Color3.fromRGB(15, 15, 15) -- Lebih gelap agar teks putih menonjol

-- 2. ANIMASI LOADING (SAAT EXECUTE)
local LoadingFrame = Instance.new("Frame")
LoadingFrame.Size = UDim2.new(1, 0, 1, 0)
LoadingFrame.BackgroundColor3 = BgColor
LoadingFrame.ZIndex = 100
LoadingFrame.Parent = ScreenGui

local LoadingContent = Instance.new("Frame")
LoadingContent.Size = UDim2.new(0, 300, 0, 100)
LoadingContent.Position = UDim2.new(0.5, -150, 0.5, -50)
LoadingContent.BackgroundTransparency = 1
LoadingContent.Parent = LoadingFrame

local LoadingText = Instance.new("TextLabel")
LoadingText.Size = UDim2.new(1, 0, 0, 40)
LoadingText.BackgroundTransparency = 1
LoadingText.Text = "☄️      Charles Hub Memuat" -- Jarak spasi diatur agar icon & teks tidak dempet
LoadingText.TextColor3 = Color3.new(1, 1, 1) -- Putih
LoadingText.Font = Enum.Font.GothamBold
LoadingText.TextSize = 22
LoadingText.Parent = LoadingContent

-- Progress Bar Background
local BarBg = Instance.new("Frame")
BarBg.Size = UDim2.new(1, 0, 0, 4)
BarBg.Position = UDim2.new(0, 0, 0, 50)
BarBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
BarBg.BorderSizePixel = 0
BarBg.Parent = LoadingContent
Instance.new("UICorner", BarBg)

-- Progress Bar Fill
local BarFill = Instance.new("Frame")
BarFill.Size = UDim2.new(0, 0, 1, 0)
BarFill.BackgroundColor3 = MainBlue
BarFill.BorderSizePixel = 0
BarFill.Parent = BarBg
Instance.new("UICorner", BarFill)

-- Jalankan Animasi Loading
task.spawn(function()
    task.wait(0.5)
    TweenService:Create(BarFill, TweenInfo.new(2, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 1, 0)}):Play()
    task.wait(2.2)
    TweenService:Create(LoadingFrame, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(LoadingContent, TweenInfo.new(0.5), {GroupTransparency = 1}):Play() -- Note: GroupTransparency butuh CanvasGroup, alternatif pakai manual:
    for _, v in pairs(LoadingContent:GetDescendants()) do
        if v:IsA("TextLabel") then TweenService:Create(v, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
        elseif v:IsA("Frame") then TweenService:Create(v, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play() end
    end
    task.wait(0.5)
    LoadingFrame:Destroy()
end)

-- 3. MAIN FRAME
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 450, 0, 300)
MainFrame.Position = UDim2.new(0.5, -225, 0.5, -150)
MainFrame.BackgroundColor3 = BgColor
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false -- Sembunyi dulu sampai loading selesai
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui
task.delay(2.7, function() MainFrame.Visible = true end)

Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)
local Stroke = Instance.new("UIStroke", MainFrame)
Stroke.Color = MainBlue
Stroke.Thickness = 1.5

-- Top Bar
local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TopBar.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Text = "☄️      Charles Hub" -- Jarak spasi ditambah
Title.Size = UDim2.new(0, 200, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.TextColor3 = Color3.new(1, 1, 1) -- Putih
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1
Title.Parent = TopBar

-- Buttons
local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0, 26, 0, 26)
CloseBtn.Position = UDim2.new(1, -35, 0, 7)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.Parent = TopBar
Instance.new("UICorner", CloseBtn)

local MinBtn = Instance.new("TextButton")
MinBtn.Text = "-"
MinBtn.Size = UDim2.new(0, 26, 0, 26)
MinBtn.Position = UDim2.new(1, -70, 0, 7)
MinBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MinBtn.TextColor3 = Color3.new(1,1,1)
MinBtn.Parent = TopBar
Instance.new("UICorner", MinBtn)

-- 4. MINIMIZE ICON (DIPERKECIL)
local MinIcon = Instance.new("TextButton")
MinIcon.Size = UDim2.new(0, 110, 0, 35) -- Ukuran lebih kecil/ramping
MinIcon.Position = UDim2.new(0, 20, 1, -55)
MinIcon.BackgroundColor3 = BgColor
MinIcon.Text = "☄️   Charles X"
MinIcon.TextColor3 = Color3.new(1,1,1) -- Putih
MinIcon.Font = Enum.Font.GothamBold
MinIcon.TextSize = 13
MinIcon.Visible = false
MinIcon.Parent = ScreenGui

local MinStroke = Instance.new("UIStroke", MinIcon)
MinStroke.Color = MainBlue
MinStroke.Thickness = 1
Instance.new("UICorner", MinIcon).CornerRadius = UDim.new(0, 8)

--- LOGIKA ANIMASI ---

CloseBtn.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.3)
    ScreenGui:Destroy()
end)

MinBtn.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Position = UDim2.new(0, 20, 1, -55), Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.4)
    MainFrame.Visible = false
    MinIcon.Visible = true
    MinIcon.Size = UDim2.new(0,0,0,35)
    TweenService:Create(MinIcon, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(0, 110, 0, 35)}):Play()
end)

MinIcon.MouseButton1Click:Connect(function()
    TweenService:Create(MinIcon, TweenInfo.new(0.2), {Size = UDim2.new(0,0,0,35)}):Play()
    task.wait(0.2)
    MinIcon.Visible = false
    MainFrame.Visible = true
    MainFrame:TweenPosition(UDim2.new(0.5, -225, 0.5, -150), "Out", "Back", 0.5)
    MainFrame:TweenSize(UDim2.new(0, 450, 0, 300), "Out", "Back", 0.5)
end)

-- Drag System
local dragging, dragInput, dragStart, startPos
TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

TopBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)
